# Orchestrate OS — Semantic Control Board

## Overview

Orchestrate OS is a governance-only semantic control plane for DataDash + Kiwi, designed to define, validate, and preview semantic rules offline. Its core purpose is to serve as a single source of semantic truth, enabling rule authoring and review as configuration rather than code. It aims to provide an analyst-first reference with clear interfaces and checklists, ensuring explicit, deterministic, and auditable decisions. The project focuses on improving operator ergonomics and streamlining the patch request and review pipeline, ultimately providing a single source of semantic truth for improved data governance.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Core Design Decisions

Orchestrate OS functions as a governance-only control plane, capturing all semantic decisions as reviewable configuration artifacts without runtime execution, APIs, credentials, or prompts. It emphasizes offline-first determinism, ensuring identical outputs for the same inputs through local previews using only the Python standard library. The system employs a canonical join strategy (`contract_key` → `file_url` → `file_name`) and a Config Pack Model (`config_pack.base.json` for baseline, `config_pack.patch.json` for changes) with strict version matching.

### UI/UX and Workflow

The user interface features a dashboard shell with a queue-centric sidebar, right-side drawers for data sources and record details, and role-based navigation. Admin configurations are presented in a workflow-ordered view with Plain-English, Payload, and Master tabs, supported by extensive tooltips and Plain English explanations. The system implements a robust 11-status lifecycle for patch requests, including comment systems, role-based access control (Analyst, Verifier, Admin), and a Patch Studio for drafting, preflight checks, and evidence packing with live previews and revision tracking. UI/UX decisions include enforcing hard page separation, RBAC route guards, and explicit page labels.

### Data Handling and Integration

Data loading defaults to `ostereo_demo_original.json` on cold start. On fresh page load without a saved session, the app automatically fetches and loads the baseline demo dataset from `/examples/datasets/ostereo_demo_original.json`. v1.6.8 adds a "Saved Datasets" section in the Data Source drawer with two selectable entries: "Ostereo (Original)" as the baseline and "Ostereo (Modified / In-Progress)" with an orange "In-Progress" badge; switching between them updates triage, signals, and grid highlights; when the modified dataset is active, a warning banner appears: "Demo dataset is in-progress (partial completion)." The toggle state persists in localStorage. Meta sheets (change logs, RFIs, etc.) are hidden from navigation but available as audit log data via the Audit Log button in SRR. The Data Source drawer includes a "Demo Dataset" section with a clickable card to load the demo data manually. Supports CSV/XLSX import with delimiter inference, and utilities for resetting demo state. The system includes a PDF proxy (FastAPI server on port 5000) for CORS-safe PDF fetching and field resolution, and utilizes `<object>` elements for PDF display. A Field Inspector and Patch Editor provide search-filtered fields, inline editing, and a lock-on-commit mechanism. v1.6.5 hides internal fields from the Inspector (File_URL_c, metrics fields) while displaying the file name in the panel header; hidden fields remain accessible internally for PDF loading. v1.6.6 adds patch badge details: grid row badges show detailed tooltips on hover with field names and patch types (Correction, RFI, Blacklist, System Change); Field Inspector highlights fields with signals using colored left borders and inline patch chips; auto-scroll to first patch field on record open. v1.6.7 moves file name to page header ("Record Inspection — <filename>"), restores "Field Inspector" as panel title, cleans up field labels (removes underscores and trailing "_c" suffix while keeping original key in sublabel), and simplifies field group names ("Primary Fields", "Secondary Fields", "Other Fields") with color-coded headers (green, blue, gray). v1.6.8 adds a change map engine that parses meta sheets (*_change_log and "RFIs & Analyst Notes") to build cell-level change tracking for the modified dataset; grid cells show color-coded highlighting (corrections=blue, RFIs=amber, system changes=gray, blacklist=red) with left border accents; row badges use accurate counts by change type with hover tooltips; Field Inspector shows change type chips for affected fields using the change map data; the change map only activates when meta sheets exist (modified dataset), while baseline remains clean with signal-based styling only. v1.6.9 seeds the Verifier RFI queue from the "RFIs & Analyst Notes" meta sheet; rows where Note Type == "RFI" are parsed into RFI artifacts with status pending_review and pushed into the Verifier queue (with deduplication on dataset_id + record_id + field_key + summary); clicking a queue item opens the correct record and field in SRR with the RFI comment visible in the thread/evidence area; audit log entries are created with action=RFI_IMPORTED, actor=user, source=legacy_rfi_import. The system features a Verifier Triage with a 4-queue system and automatic view swapping based on roles, plus a localStorage-backed mock filesystem for artifacts and a deterministic artifact ID system. A Canonical Record Store persists records to localStorage, enabling Single Row Review (SRR) rehydration.

### Semantic Rules and Signals

The system generates deterministic cell-level signals on dataset load using `field_meta.json` and `qa_flags.json` for validation (e.g., `MISSING_REQUIRED`, `PICKLIST_INVALID`, `MOJIBAKE_DETECTED`, `QA_FLAG`). These signals populate Analyst Triage queues, and drive grid coloring and row badges in the All-Data Grid, with cell coloring based on signal priority. Field Inspector ordering is derived from `field_meta.json`, `hinge_groups.json`, and `sheet_order.json` from the `/rules/rules_bundle/`. Rules follow a WHEN/THEN pattern with `rule_id`, conditions (sheet, field, operator, value), and actions (action, sheet, field, severity).

### Identity and Authentication

Record identity is defined by `tenant_id`, `division_id`, `dataset_id`, `record_id`, with `record_id` generated based on a canonicalized row fingerprint. A landing page with mock Google sign-in and role selection (Analyst/Reviewer/Admin) handles user authentication and role-based access. v1.6.22 enforces role-based mode restrictions: Analyst users are locked to analyst mode only, Reviewer users locked to reviewer mode only, with mode switcher buttons hidden and replaced by a role indicator; Admin users have full "God mode" access with ability to switch between all roles; all roles have a "Sign Out" link in the sidebar to return to landing page. Folder-based data sources are auto-mapped from user email. v1.6.9 adds stable row mapping for meta sheets: change logs and RFI sheets use `{sheet}:{row}` format for record IDs instead of hash-based `rec_*` IDs, enabling deterministic row mapping between meta sheets and data sheets. The modified demo dataset (ostereo_demo_v1.json) is sanitized via `scripts/sanitize_demo_dataset.py` to remove error log text (timeout messages, auto-failure strings) and header-like values from data cells. v1.6.10 adds picklist/options field support: fields marked with `picklist: true` in field_meta.json render as dropdowns in the Field Inspector with an "Options" badge; invalid values show a subtle warning badge; picklist validation (PICKLIST_INVALID signals) only runs on primary data sheets (Accounts, Opportunity, Financials, Catalog, Schedule, Schedule Catalog, V2 Add Ons, Contacts), skipping meta sheets and empty-like values. v1.6.11 adds strong DataDash-style grid cell coloring for the modified dataset: Correction (#CFE8FF blue), RFI (#FFE7B3 amber), System Change (#EFEFEF gray), Blacklist (#FFD6D6 red), Verified (#DDF5DD green); includes a color legend above the grid that appears only for modified dataset; baseline dataset stays neutral/uncolored. v1.6.12 fixes PDF anchor overlay to be non-blocking: clicking a field shows a subtle toast and highlight box that auto-dismiss after 2.5 seconds; ESC key or clicking outside clears the highlight immediately; if no anchor data exists for a field, a toast shows "No anchor found"; the PDF remains fully visible and interactive at all times. v1.6.13 configures PDF viewer for single-column continuous scroll with hidden thumbnail sidebar: uses navpanes=0 to hide left thumbnail panel, scrollbar=1 for vertical scroll, view=FitH to fit width, toolbar=1 to keep controls visible. v1.6.14 fixes grid cell highlighting by adding field inference logic that matches old_value/new_value against target row fields to determine which field was changed when field_name is empty in change logs; includes row-level change fallback for rows where field cannot be inferred; verified 607 changes across 163 records with proper type distribution (system_change, correction, blacklist, rfi). v1.6.15 improves Field Inspector: panel widths equalized (320px each) to match Patch Editor; replaces OPTIONS/INVALID VALUE pills with asterisk markers (* for options fields, ** for invalid values) in field labels; adds legend at top of inspector panel; dropdown selects work for picklist fields with proper value selection and change handling. v1.6.16 adds user creation in Admin Panel for Demo/Playground mode: "+ Add User" button opens modal form with name, email, role, status, and division fields; email validation and duplicate checking; users persist to localStorage with preProvisioned flag for future auth readiness; delete button for added users; status badges show active/pending/disabled states. v1.6.17 switches default mode from Demo to Production: isDemoMode() now defaults to false; user management controls (add/edit/delete) are locked in production mode with "Demo mode only" messages; this prepares the app for production deployment while retaining demo mode toggle capability. v1.6.18 fixes grid highlights and performance: adds row-change classes (.row-added/.row-changed/.row-removed) to both virtualized and non-virtualized grid renderers; normalizes status column lookup across header variants (status, Status, sf_contract_status, review_state, Review_State); fixes O(n^2) _originalIdx seeding to O(n); adds change-map key fallback (record_id → sheet:rowIndex) when join-triplet is missing; adds ?perf=1 URL flag for timing logs; bumps datasetRevision on import/activation for cache invalidation. v1.6.19 disables QA_FLAG signal generation for missing required (F-REQ-001) since MISSING_REQUIRED signal already covers this case; this prevents duplicate entries in triage queues (one in Patch Queue, one in SF Logic Flags); the other qa_flags (F-PAT-001 pattern mismatch, F-NA-001 N/A field population) are not yet implemented; Salesforce Logic Flags queue will be empty until pattern-based detection is added. v1.6.20 adds UI filter for reference/glossary sheets: REFERENCE_SHEET_PATTERNS constant defines sheets like Glossary, Field Dictionary, Opportunity_Field_Catalog, QA_Flags, Hinge, Mapping, etc.; filterOutReferenceData() function filters sf_issues and sf_field_actions to exclude items from these sheets; applied at all data load points (loadFromData, session restore, primary fetch, artifact load) to prevent supporting data from appearing in triage queues. v1.6.23 adds staged loader overlay for long dataset loads: full-page overlay with spinner shows 5 pipeline stages (Loading dataset, Standardizing fields, Validating rules, Building change map, Rendering grid); current stage highlighted in blue with pulsing icon, completed stages show green checkmarks; 300ms delay prevents flicker on fast loads; overlay hides automatically when rendering completes or on error; hooks into loadSampleDataset, loadFromData, and generateSignalsForDataset pipeline.

## External Dependencies

None by design. This repository exclusively uses the Python standard library. It has no external Python packages, database connections, API integrations, runtime services, or credentials/secrets.