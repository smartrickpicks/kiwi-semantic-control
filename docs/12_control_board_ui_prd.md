# 12 — Control Board UI PRD

[
  {
    "path": "docs/12_control_board_ui_prd.md",
    "content": "# 12 — Control Board UI PRD (Governance‑Only, Offline‑First)\n\n## 1) Problem / Why this UI exists\n- This UI is a governance surface for the semantic control plane. It allows operators to author, validate, preview, and export semantic rules as files.\n- It is not a runtime console. It does not execute pipelines, call external APIs, or manage credentials.\n- It standardizes deterministic, artifact‑driven workflows so that semantics remain explicit, auditable, and reproducible.\n\nSuccess criteria\n- Operators can complete the Discover→Draft→Validate→Preview→Export→PR/Review→Version loop using only local artifacts.\n- Deterministic preview (smoke) is the arbiter of correctness; UI never treats editor/LSP diagnostics as authoritative.\n\n---\n\n## 2) Personas\n- Operator\n  - Can: discover issues, draft rules (intent + mapping), run validation/preview locally, prepare/export patches, update expected outputs when intentional, assemble PR packages.\n  - Cannot: run DataDash, call Salesforce or other APIs, store credentials, edit base without process.\n- Verifier\n  - Can: review diffs, validation reports, preview evidence, ensure checklist compliance, approve version bumps.\n  - Cannot: bypass smoke gate, merge changes without artifacts.\n- Analyst\n  - Can: propose rule intent (WHEN/THEN/BECAUSE), map to patch schema, provide example scenarios.\n  - Cannot: modify determinism settings or introduce runtime connectors.\n\n---\n\n## 3) Information Architecture (aligned with 08_control_board_ui_spec)\nLeft‑Nav Sections and Tabs\n1) Overview\n   - Welcome, Scope & Truth, Changelog\n2) Authoring\n   - Rule Drafts, Patch Builder, Templates\n3) Validation\n   - Shape Validator, Conflict Checker, Determinism Rules\n4) Preview\n   - Baseline Preview, Edge‑Case Preview, Diff Pane\n5) Export\n   - Patch Export, PR Summary, Governance Checklist\n6) Evidence\n   - Smoke Logs, Baselines, Expected Outputs\n7) Settings (Local‑Only)\n   - Paths, Sorting Rules, Conventions\n\nDataDash ergonomics\n- All Data Grid (sortable tables), issue drilldown, diff panes, rule editor with side‑by‑side intent→schema mapping.\n\n---\n\n## 4) Core Flows with Acceptance Criteria\nFlow: Discover → Draft → Validate → Preview → Export Patch → PR/Review → Version\n\n4.1 Discover\n- Behavior: List current examples, expected outputs, recent changes; overview tables of preview issues (if any) from last run.\n- AC\n  - Table supports sort by severity (blocking > warning > info), subtype, join triplet; stable ordering.\n  - Links to relevant artifacts open locally (no network calls).\n\n4.2 Draft\n- Behavior: Author rule intent (WHEN/THEN/BECAUSE) and map to patch schema fields (rule_id, when, then, severity).\n- AC\n  - Rule Draft object stored locally (UI draft JSON), not auto‑applied to config.\n  - Mapping UI prevents invalid operators/actions and enforces canonical sheet/field names.\n  - Draft can be added to a Patch Draft (not yet exported).\n\n4.3 Validate\n- Behavior: Run offline validator to produce a validation report (shape + conflicts + base_version guard).\n- AC\n  - Shows status ok/error, missing sections, conflict descriptions, and counts.\n  - No external calls; validator output is rendered verbatim with friendly formatting.\n  - Failing base_version mismatch blocks export.\n\n4.4 Preview\n- Behavior: Run harness via shell to produce sf_packet.preview.json for baseline or edge‑case dataset; show diff vs expected.\n- AC\n  - Baseline and edge‑case modes available; default is baseline.\n  - Diff pane uses normalized JSON (sorted keys); array ordering is stable and deterministic.\n  - UI indicates \"pass\" only if strict smoke reports no diff; otherwise shows unified diff and remediation hints.\n\n4.5 Export Patch\n- Behavior: Convert Patch Draft → config_pack.<version>.patch.json (changes[]), write to config/ after explicit confirmation.\n- AC\n  - File write requires operator confirmation; path shown before save.\n  - No changes applied to base; only a new patch file is created.\n  - Optionally produce a PR summary markdown with WHY, affected files, and smoke status.\n\n4.6 PR/Review\n- Behavior: Present governance checklist (REVIEW_CHECKLIST.md), smoke evidence, and CHANGELOG template.\n- AC\n  - Verifier can verify strict smoke pass and validation report.\n  - UI blocks \"ready for review\" status if smoke failed or validation blocked.\n\n4.7 Version\n- Behavior: Guide version bump and CHANGELOG updates; operator must confirm writes.\n- AC\n  - Version bump recorded only on explicit confirmation; UI never edits files silently.\n  - CHANGELOG entry includes WHY and smoke evidence references.\n\n---\n\n## 5) Artifact I/O Map (files only)\nReads\n- config/config_pack.base.json\n- config/*.patch.json (including new Patch Draft target)\n- examples/standardized_dataset.*.json, examples/expected_outputs/*.json\n- out/sf_packet.preview.json, validator stdout/stderr captured locally\n- CHANGELOG.md\n\nWrites (explicit confirmations required)\n- config/config_pack.<version>.patch.json (new patch)\n- examples/expected_outputs/*.json (only when operator chooses to update expected)\n- CHANGELOG.md (append entries; template + confirm)\n- Optional: docs/replit_baseline.md (append environment/hash notes)\n\nAll writes are local file operations. No network usage.\n\n---\n\n## 6) Determinism Requirements\n- Sorting rules\n  - Contract rows: join triplet (contract_key asc, file_url asc, file_name asc; nulls last)\n  - Issues/actions/change log: (contract_key, file_url, file_name, sheet, field, type)\n  - Severity chips: blocking > warning > info\n- Smoke is the arbiter\n  - Baseline smoke must pass before a patch is considered reviewable.\n  - Edge‑case smoke required if join/fallback is affected.\n- UI diagnostics are non‑authoritative; they must reflect harness outputs.\n\n---\n\n## 7) Non‑Goals / Out‑of‑Scope\n- No runtime execution or external connectors (Salesforce, S3, etc.)\n- No credentials or secret handling\n- No LLM prompts or model behavior definition\n- No API integrations; artifact‑based I/O only\n- No production parity claims (governance preview only)\n\n---\n\n## 8) MVP vs vNext\nMVP (read‑only viewer + runner)\n- Read and render sf_packet.preview.json and validation report\n- Run validation and preview via shell commands\n- Show diffs vs expected outputs (normalized JSON)\n- Acceptance (MVP)\n  - Can load baseline/edge datasets and produce pass/fail clearly\n  - Can open related artifacts (base, patch, expected outputs) locally\n  - No write operations without explicit confirmation dialogs\n\nvNext (draft builder + export helper)\n- Rule Draft editor (intent + mapping), Patch Draft builder\n- Patch export to config/; PR summary generator\n- Governance checklist integration; version bump helper\n- Acceptance (vNext)\n  - Patch export creates valid patch file with changes[]\n  - Strict smoke can be run from the UI wrapper and its outcome is displayed\n\n---\n\n## 9) Open Questions (≤10)\n1) Should the UI provide a guided wizard for rule_id naming to reduce collisions?\n2) What minimal lint rules should apply to descriptions (e.g., require WHY sentence)?\n3) Should expected outputs update flow require dual confirmation (author + verifier) before write?\n4) How should the UI display multiple patch drafts targeting the same base (folder vs labeled table)?\n5) Is a dry‑run mode for patch export useful (write to temp path first)?\n6) Do we need a batch preview mode to compare multiple datasets in one session?\n7) Should the UI surface a simple hash (SHA256) for preview outputs to simplify audits?\n8) How much of the smoke script log should be stored as evidence in the repo (size vs audit need)?\n9) Is a minimal redaction step needed for local logs before attaching to PR summaries?\n10) Should the UI enforce a default version bump strategy (patch/minor) based on rule impact categories?\n"
  }
]
