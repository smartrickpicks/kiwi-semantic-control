{
  "task": "Orchestrate OS v1.4.x â€” Lock, Multi-Sheet Grid, Unknown Columns Admin UX",
  "constraints": {
    "mode": "offline_first",
    "determinism": true,
    "network_calls": false,
    "exports": "copy_only",
    "rbac": "router_and_render_enforced",
    "no_runtime_services": true
  },
  "do_not_change": [
    "Grid is default landing when dataLoaded=true",
    "Triage acts as alert lens linking to Grid",
    "Loader is a centered modal (non-routable) with focus trap and ESC/backdrop close",
    "Admin UI only exists under #/admin/* with router-level guard"
  ],
  "option_c_multi_sheet_power_user_ux": {
    "data_model": {
      "input_types": ["CSV", "XLSX"],
      "canonical_output": {
        "merged_dataset": {
          "sheets": {
            "<sheet_name>": {
              "headers": "canonicalized headers array",
              "rows": "array of row objects",
              "row_count": "integer",
              "issues": "array of sheet-scoped issues"
            }
          }
        }
      },
      "ordering": "config_pack_order_if_available_else_lexical"
    },
    "grid_sheet_dropdown": {
      "location": "grid_toolbar",
      "behavior": [
        "switches active sheet",
        "updates URL deterministically",
        "filters apply within active sheet only"
      ],
      "url_params": ["sheet", "f", "q"],
      "source_of_truth": "URL"
    },
    "per_sheet_mini_stats": {
      "location": "grid_header",
      "metrics": [
        "row_count",
        "status_counts",
        "unknown_columns_count"
      ]
    },
    "triage_deep_links": {
      "behavior": "triage_chips_link_to_filtered_grid",
      "url_pattern": "#/grid?f=<status>&sheet=<sheet>"
    },
    "cross_sheet_search_optional": {
      "enabled": false,
      "if_enabled": {
        "url": "#/grid?q=<term>&scope=all_sheets",
        "result_behavior": "grouped_by_sheet_then_open_grid_with_highlight"
      }
    }
  },
  "option_a_lock_and_stabilize": {
    "grid_visual_polish": {
      "dense_rows": true,
      "sticky_header": true,
      "horizontal_scroll": true,
      "column_resize": "minimal",
      "column_visibility_toggle": true
    },
    "row_virtualization": {
      "enabled_when_row_count_gt": 2000,
      "requirements": [
        "deterministic_ordering",
        "no_third_party_libraries"
      ]
    },
    "smoke_tests": [
      {
        "name": "role_switch_teardown",
        "assertions": [
          "admin_ui_unmounts_on_role_downgrade",
          "admin_routes_blocked_pre_render"
        ]
      },
      {
        "name": "grid_row_back_navigation",
        "assertions": [
          "row_review_opens",
          "back_returns_to_same_sheet_and_filters"
        ]
      },
      {
        "name": "loader_modal_focus",
        "assertions": [
          "focus_trapped_in_modal",
          "esc_and_backdrop_close",
          "focus_returns_to_trigger"
        ]
      }
    ]
  },
  "admin_unknown_columns_schema_drift": {
    "detection": {
      "stage": "standardization",
      "comparison": "incoming_headers_vs_canonical_fields",
      "output": {
        "unknown_columns": {
          "<sheet_name>": [
            {
              "original_name": "string",
              "normalized_name": "string",
              "sample_values": ["value1", "value2"],
              "count_nonempty": "integer",
              "suggested_canonical": "optional_string"
            }
          ]
        }
      }
    },
    "admin_only_ui": {
      "location": "Admin > Standardizer_or_Inspector",
      "table_fields": [
        "sheet",
        "original_name",
        "sample_values",
        "count_nonempty"
      ],
      "actions": [
        "add_to_standard_global",
        "mark_source_specific",
        "ignore"
      ]
    },
    "copy_only_exports": {
      "artifact": "standard_update_request.json",
      "fields": [
        "request_id",
        "timestamp_utc",
        "sheet",
        "canonical_field_name",
        "source_aliases",
        "classification",
        "source_tag_optional"
      ],
      "persistence": "localStorage"
    },
    "source_specific_behavior": {
      "visibility": "only_for_dataset",
      "labeling": "FieldName (Source)",
      "does_not_pollute_global_standard": true
    }
  },
  "acceptance_criteria": [
    "Multi-sheet XLSX upload renders sheet dropdown and allows switching",
    "Triage chips deep-link to Grid with correct filters and sheet context",
    "Unknown columns visible only to Admin with actionable decisions",
    "Admin actions generate copy-only JSON artifacts",
    "RBAC prevents admin bleed into Analyst/Reviewer",
    "Smoke tests pass for role teardown, navigation, and modal focus"
  ],
  "delivery": {
    "commit": true,
    "changelog_entry": true,
    "how_to_test": "short_steps_with_expected_outcomes"
  }
}