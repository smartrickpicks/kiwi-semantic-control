Replit Task: Artifact Store (localStorage mock filesystem) + Role Handoff Routing

Please update index.html to implement a file‑like Artifact Store backed by localStorage, enforce the artifact envelope contract, and route queues via dataset_id + record_id + field_key (no row index).

Decision

Storage now: localStorage
Storage mode: mock filesystem keys (prefix fs:)
Requirements

Storage Adapter
Implement helpers: fsRead(path), fsWrite(path, contents), fsAppend(path, line), fsList(prefix)
Back these with localStorage keys prefixed by fs:
All paths must be env + workspace scoped.
Path Convention
workspace_id = ws_default
environment = playground (default)
Paths:
events.jsonl
{artifact_id}.json
{thread_id}.json
localStorage keys must be prefixed with fs:
Example: events.jsonl
Artifact Envelope Contract
Required fields:
workspace_id
environment
dataset_id
record_id
field_key
artifact_type (rfi | patch_request)
status (open, submitted, needs_clarification, etc.)
created_by_actor_id
created_at
thread_id
source_pointers
body
Persist each artifact at {artifact_id}.json.

Event Log
Append line‑delimited JSON to events.jsonl for:
RFI_CREATED
RFI_REPLIED
PATCH_DRAFT_CREATED
PATCH_REQUEST_SUBMITTED
Queue Generation
Analyst view: artifacts created_by role=analyst OR assigned_to=analyst.
Verifier view: artifact_type=rfi and status=open.
Admin view: artifact_type=patch_request and status=submitted (stub).
Routing by Artifact Pointers
On queue click: set active_dataset_id + active_record_id from artifact.
SRR loads record by record_id lookup (not row index).
Optionally focus field_key.
Playground Mode
Environment selector: playground/prod (prod locked for now).
Role + actor dropdowns only in playground.
Reset Playground clears only playground fs: keys.
Implementation Notes

Do not store PDFs in localStorage.
Deterministic IDs:
artifact_id = hash(dataset_id + record_id + field_key + created_at)
If record_id missing, derive from stable row hash of canonical columns.
Acceptance

Creating an RFI stores an artifact with dataset_id + record_id + field_key.
Verifier queue opens the correct record regardless of grid sorting.
RFI reply appends to thread + updates artifact status.
Reset Playground clears only playground artifacts/events.
No code path relies on row index for routing.
Suggested commit: ui(srr): artifact store + env routing

If you want me to add a minimal hash helper (non‑crypto) for artifact_id, I can include that in the prompt too.