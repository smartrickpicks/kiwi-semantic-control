Totally hear you — we’ll make the grid coloring **derive from a single signal→style map** so the UI and the final Excel export stay consistent. Below is the Replit prompt for **Grid coloring + row badges**, with the export‑mapping hook built in and your DataDash template as the reference.

---

**Replit Task: Grid Coloring + Row Badges (Signal‑Driven, Export‑Aligned)**

**Goal**  
Add cell coloring + row badges in the All‑Data Grid based on the Signal Engine, and store the same style metadata so the **final Excel export can match the UI**.

---

## 1) Central Signal → Style Map (single source of truth)
Create a map like:

```
SIGNAL_STYLE_MAP = {
  MANUAL_REVIEW: { label, bg, text },
  SALESFORCE_LOGIC: { ... },
  PATCH_REQUIRED: { ... },
  SYSTEM_CHANGE: { ... },
  CLEAN: { ... }
}
```

**Mapping (align to DataDash template):**
- **Manual Review (Mojibake)** → soft **yellow**  
- **Salesforce Logic Flags (QA_FLAG ERROR/WARN)** → soft **orange**  
- **Patch Required (MISSING_REQUIRED, PICKLIST_INVALID)** → soft **blue**  
- **System Changes (QA_FLAG INFO)** → **neutral gray**  
- **Clean / No Signals** → **very light green** (validated)

> Use very light tints so it feels like a spreadsheet highlight (not blocks of color).

---

## 2) Cell Coloring in Grid
- For each cell, compute its **highest‑priority signal**  
- Apply the corresponding background tint  
- If multiple signals exist, choose the **highest priority** order:
  1) Patch Required  
  2) Salesforce Logic  
  3) Manual Review  
  4) System Changes  
  5) Clean  

---

## 3) Row Badges
Add compact row badges (left or right of the row) showing counts for:

- Manual Review  
- Salesforce Logic  
- Patch Required  
- System Changes  

Badges should reflect **counts of signals in that row**.

---

## 4) Export Alignment (metadata hook)
Store per‑cell style metadata so export can match UI later:

```
dataset.cell_styles[record_id][field_key] = {
  status: "PATCH_REQUIRED",
  color: "#DDEBFF",
  label: "Patch Required"
}
```

This is **only metadata**, no export code yet.

---

## 5) Reference Template
Use the DataDash example spreadsheet as a visual guide:  
`Ostereo Distribution Agreement Extractions (2).xlsx`  
(If not available in Replit, just follow the color rules above.)

---

## Acceptance
- Grid cells show light tints based on signals  
- Row badges show correct signal counts  
- `cell_styles` metadata is populated  
- No visual clash with existing hover styles  

**Suggested commit**  
`feat(grid): signal-driven coloring + row badges + export style metadata`

---

If you want, I can also add a tiny legend toggle in the grid header so users can see what each color means, but that’s optional.