{
  "agent": "REPLIT",
  "role": "ui_implementer",
  "task_type": "FEATURE_BUILD",
  "task_id": "CBV-0.4",
  "title": "Control Board Viewer v0.4 — Universal Drilldown + Copy PR Kit",
  "scope_lock": [
    "Governance-only",
    "Offline-first",
    "Read-only viewer",
    "No runtime execution",
    "No network calls",
    "No file writes from UI"
  ],
  "objective": "Improve operator throughput by allowing drilldown from any table row and providing copy-only PR artifacts.",
  "features": [
    {
      "name": "Universal Drilldown",
      "requirements": [
        "Clicking rows in Contract Results, Issues, or Field Actions opens the Record Workbench",
        "Workbench join identity is derived from the clicked row using join triplet (contract_key → file_url → file_name)",
        "Workbench tabs remain: Contract / Issues / Field Actions / Change Log",
        "If multiple contracts match the same join identity, show a warning banner but proceed deterministically"
      ]
    },
    {
      "name": "Copy PR Kit (Copy-only)",
      "requirements": [
        "Add buttons in the Workbench header:",
        "Copy PR Summary (Markdown)",
        "Copy Patch Skeleton (JSON)",
        "Copy Rule Draft (WHEN / THEN / BECAUSE)",
        "All copied content must be derived from the currently selected record(s)",
        "No files are written; clipboard only"
      ]
    },
    {
      "name": "Normalized Copy Output",
      "requirements": [
        "All copied JSON must have sorted keys and stable ordering",
        "PR summary markdown must include:",
        "- Title",
        "- WHY section",
        "- Affected artifacts",
        "- Smoke status (if available, else 'unknown')"
      ]
    },
    {
      "name": "Identity Clarity",
      "requirements": [
        "Join identity pill must visually indicate which key is acting as PRIMARY",
        "Example: PRIMARY: contract_key, fallback: file_url",
        "Nulls must be explicit and treated as non-primary"
      ]
    }
  ],
  "acceptance_criteria": [
    "All tables can open the Record Workbench",
    "Workbench content is scoped strictly to join identity",
    "Copy buttons produce deterministic, reusable artifacts",
    "No dependencies added",
    "Viewer remains a single-file vanilla HTML + JS implementation",
    "Smoke test instructions remain informational only"
  ],
  "out_of_scope": [
    "Executing commands",
    "Writing patch files",
    "Network requests",
    "Authentication",
    "LLM prompts"
  ],
  "expected_outputs": [
    "Updated ui/viewer/index.html",
    "Updated ui/viewer/README.md documenting v0.4 features"
  ],
  "completion_signal": "Control Board Viewer v0.4 complete; all acceptance criteria pass."
}