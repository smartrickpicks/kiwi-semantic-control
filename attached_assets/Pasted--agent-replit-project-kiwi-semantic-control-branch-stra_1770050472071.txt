{
  "agent": "replit",
  "project": "kiwi-semantic-control",
  "branch_strategy": {
    "create_branch": true,
    "branch_name_suggestion": "ui/data-source-panel-layout-v1.5",
    "note": "Do not claim push/PR unless you output a verifiable GitHub URL."
  },
  "goal": "Refine the Data Source right-side panel layout + align docs/UI copy with Kiwi terminology lock (Review States, surfaces, Patch Request wording).",
  "ui_changes": [
    {
      "id": "DS-UI-01",
      "title": "Re-layout Upload + Connect stubs into one row",
      "scope": "Data Source right-side panel (active + empty states)",
      "requirements": [
        "Move 'Upload New Dataset' dropzone and 'Connect External Source' (Google Drive + MCP stubs w/ V2 badges) into the SAME horizontal row (two columns).",
        "Both tiles must be visible without scrolling on standard viewport.",
        "Connect tiles remain disabled/stubbed and clearly marked 'V2'.",
        "Keep the helper text: uploading rotates current active dataset to Saved."
      ],
      "acceptance": [
        "Active state: Active Dataset card on top, then a single row with (Upload tile | Connect tile).",
        "Empty state: 'No Active Dataset' message, then the same single row (Upload | Connect)."
      ]
    },
    {
      "id": "DS-UI-02",
      "title": "Move the Search Stub into the Data Source panel between the row and Saved Datasets",
      "scope": "Data Source panel only (not global header search; keep global search stub if it already exists)",
      "requirements": [
        "Insert a search input (stub) BETWEEN the (Upload|Connect) row and the 'Saved Datasets' section.",
        "Placeholder: 'Search agreements, accounts, record IDs'.",
        "Stub behavior: on input or Enter, show a 'Coming soon' toast; no filtering required yet.",
        "Add a small 'V2' badge on the search label or in the placeholder suffix to signal stub status."
      ],
      "acceptance": [
        "Search is visually located above Saved Datasets and below the Upload|Connect row.",
        "No runtime search logic is required (stub only)."
      ]
    },
    {
      "id": "DS-UX-03",
      "title": "Preserve Active Dataset protection + disconnect mechanics",
      "scope": "Ensure existing behavior remains correct",
      "requirements": [
        "Active dataset cannot be deleted.",
        "Disconnect is accessible via the ACTIVE badge dropdown on the Active Dataset card.",
        "If only one dataset exists and it is active, user can still reach the 'No Active Dataset' state by disconnecting (not by deleting)."
      ],
      "acceptance": [
        "Disconnect -> Active becomes none; dataset appears under Saved Datasets.",
        "Delete buttons remain disabled for active dataset with tooltip 'Disconnect first'."
      ]
    }
  ],
  "file_type_support_check": [
    {
      "id": "DS-DATA-04",
      "title": "Confirm CSV + XLSX ingestion support and multi-sheet routing",
      "requirements": [
        "Panel upload must accept .csv and .xlsx.",
        "If XLSX has multiple sheets, system should persist the workbook as a dataset and allow the All-Data Grid to switch sheets (existing behavior may already do this; verify).",
        "If behavior is stubbed, add a clear UI hint 'Multi-sheet support: supported' or 'coming soon'â€”but do not fake functionality."
      ],
      "acceptance": [
        "User can drop CSV or XLSX without errors.",
        "If multi-sheet exists today, ensure it still works after layout changes.",
        "If not implemented, explicitly label as V2 stub (no silent failure)."
      ]
    }
  ],
  "docs_updates": [
    {
      "id": "DOC-01",
      "paths": [
        "docs/ui/views/load_data_view.md",
        "docs/overview.md",
        "docs/ui/ui_principles.md",
        "docs/INDEX.md"
      ],
      "requirements": [
        "Update documentation to reflect: Data Source is a right-side panel (no modal), opened from quick-action bar only (not sidebar).",
        "Update the panel layout description: Active card -> (Upload|Connect) row -> Search stub -> Saved Datasets -> Close.",
        "Maintain Kiwi terminology lock: Review States (To Do, Needs Review, Flagged, Blocked, Finalized), surfaces naming (All Data Grid, Single Row Review, Verifier Review, Admin Approval, Audit Log).",
        "Ensure any remaining 'Queue' wording is NOT reintroduced; Patch Authoring action remains 'Submit Patch Request'."
      ]
    }
  ],
  "non_goals": [
    "Do not implement real search or indexing yet (stub only).",
    "Do not add external integrations (Drive/MCP are V2 stubs only).",
    "Do not change review state gating rules."
  ],
  "qa_checklist": [
    "Verify Data Source is removed from sidebar and accessible via quick-action button only.",
    "Verify panel opens for both loaded and unloaded states (no modal).",
    "Verify active dataset cannot be deleted and disconnect works.",
    "Verify upload accepts CSV and XLSX (no regressions).",
    "Verify docs reflect layout + terminology lock."
  ],
  "handoff": {
    "what_to_return": [
      "List of files changed",
      "Screenshots: Data Source panel (empty state + active state) showing new layout",
      "Any remaining terminology drift findings (if any) with file paths + line references",
      "Exact git commands you ran locally (add/commit/push) BUT do not claim pushed unless you include a verifiable GitHub commit/PR URL"
    ]
  }
}