{
  "ROUTE": "BUILD_TASK_CODEX",
  "goal": "Implement SRR Field Inspector mini-queue behavior with Verify/Blacklist/RFI actions, field-state tracking, filters, and guard modal. Auto Patch Type is driven by action (read-only).",
  "files_in_scope": [
    "ui/viewer/index.html",
    "docs/handoff/TASKS_UI.md"
  ],
  "constraints": [
    "Offline-first only; no network calls.",
    "Patch Type must be auto-driven by field action; user cannot manually select it.",
    "Do not change canonical tokens (single_row_review, submit_patch_request).",
    "No invented completion claims; use “Unknown — requires audit” where needed."
  ],
  "implementation_steps": [
    {
      "step": "A) Field state model",
      "details": [
        "Add local field-state per field: TODO (default), VERIFIED, RFI, PATCHED.",
        "Persist state in SRR local state only (no backend)."
      ]
    },
    {
      "step": "B) Field card actions",
      "details": [
        "Add action buttons to each field card: Verify (green), Blacklist (red flag), RFI (purple).",
        "Verify sets field state = VERIFIED and animates it out of TODO list.",
        "Blacklist sets field state = PATCHED and auto Patch Type = Blacklist Flag; auto-populate blacklist subject from field/value.",
        "RFI sets field state = RFI and auto Patch Type = RFI."
      ]
    },
    {
      "step": "C) Auto Patch Type",
      "details": [
        "Make Patch Type read-only (label only).",
        "Patch Type driven by actions: Patch edit = Correction, Blacklist = Blacklist Flag, RFI = RFI."
      ]
    },
    {
      "step": "D) Filters",
      "details": [
        "Add filter chips: To Do, Verified, RFI, Needs Patch, All.",
        "Filter counts should reflect the field-state totals."
      ]
    },
    {
      "step": "E) Guard modal",
      "details": [
        "On leaving SRR (Back to Grid), if any fields are PATCHED or RFI, show guard modal.",
        "Guard modal options: Save Draft, Discard Changes, Stay Here.",
        "VERIFIED fields do not trigger the guard."
      ]
    },
    {
      "step": "F) TASKS_UI update",
      "details": [
        "Append a backlog item for the UI implementation of mini-queue behavior.",
        "Include acceptance tests and Evidence link = “Unknown — requires audit”."
      ]
    }
  ],
  "acceptance_tests": [
    "AT-01: Verify action sets VERIFIED and removes field from TODO list.",
    "AT-02: Blacklist action sets PATCHED + auto Patch Type = Blacklist Flag, without editing value.",
    "AT-03: RFI action sets RFI + auto Patch Type = RFI.",
    "AT-04: Editing a field sets PATCHED + auto Patch Type = Correction.",
    "AT-05: Filter chips reflect correct counts (TODO/Verified/RFI/Needs Patch/All).",
    "AT-06: Guard modal appears when leaving SRR with unresolved PATCHED/RFI fields.",
    "AT-07: Patch Type is not user-editable."
  ],
  "suggested_commit_message": "feat(srr): field inspector mini-queue + auto patch-type actions"
}
